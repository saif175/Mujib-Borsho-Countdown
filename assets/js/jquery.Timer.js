(function(b){var l=function(a,h){this.element=a;this.element.hasClass("Timer")||this.element.addClass("Timer");this.userOptions=h;this.defaultOptions=l.defaults;this.options=b.extend({},this.defaultOptions,this.userOptions);if(this.element.find(".seconds").length>0)this.options.seconds=this.element.find(".seconds")[0];if(this.element.find(".minutes").length>0)this.options.minutes=this.element.find(".minutes")[0];if(this.element.find(".hours").length>0)this.options.hours=this.element.find(".hours")[0];
  if(this.element.find(".days").length>0)this.options.days=this.element.find(".days")[0];this.initDate=new Date;this.options.date=new Date(this.options.date);this.calculateDate()};l.defaults={seconds:false,minutes:false,hours:false,days:false,date:(new Date).toDateString(),direction:"up",callback:null,digitTemplate:'<div class="digit"> <div class="digit-top"> <span class="digit-wrap"></span> </div> <div class="shadow-top"></div> <div class="digit-bottom"> <span class="digit-wrap"></span> </div> <div class="shadow-bottom"></div></div>'};
  l.prototype={calculateDate:function(){var a;if(this.options.direction=="down")a=this.options.date-this.initDate;else if(this.options.direction=="up")a=this.initDate-this.options.date;this.seconds=Math.floor(a/1E3)%60;this.minutes=Math.floor(a/1E3/60)%60;this.hours=Math.floor(a/1E3/3600)%24;this.days=Math.floor(a/1E3/60/60/24);this.render()},render:function(){this.options.seconds&&this.renderDigits(this.options.seconds,this.seconds);this.options.minutes&&this.renderDigits(this.options.minutes,this.minutes);
      this.options.hours&&this.renderDigits(this.options.hours,this.hours);this.options.days&&this.renderDigits(this.options.days,this.days);this.startTimer()},renderDigits:function(a,h){var c,d,f,j,i,e=this,g;if(b(a).find(".digit").length==0){if(e.days<0&&e.hours<0&&e.minutes<0&&e.seconds<0)g=[0,0];else{g=String(h).split("");g.length<2&&g.unshift(0)}j=a==e.options.seconds||a==e.options.minutes?5:a==e.options.hours?2:9;g.forEach(function(){b(a).append('<div class="digit-set"></div>')});b(a).find(".digit-set").each(function(k){f=
        k==0?j:9;for(c=0;c<=f;c++){b(this).append(e.options.digitTemplate);d=e.options.direction=="down"?f-c:c;i=b(this).find(".digit")[c];b(i).find(".digit-wrap").append(d);if(d==g[k])b(i).addClass("active");else if(g[k]!=0&&d+1==g[k])b(i).addClass("previous");else g[k]==0&&d==f&&b(i).addClass("previous")}})}},startTimer:function(){var a=this;clearInterval(this.timer);this.timer=setInterval(function(){if(a.days<=0&&a.hours<=0&&a.minutes<=0&&a.seconds<=0){a.options.callback&&a.options.callback();clearInterval(a.timer)}else if(a.days>
        999||a.days==999&&a.hours==23&&a.minutes==59&&a.seconds==59)clearInterval(a.timer);else{a.options.direction=="down"?a.seconds--:a.seconds++;a.options.seconds&&a.increaseDigit(a.options.seconds);if(a.seconds==60||a.seconds==-1){if(a.options.direction=="down"){a.seconds=59;a.minutes--}else{a.seconds=0;a.minutes++}a.options.minutes&&a.increaseDigit(a.options.minutes)}if(a.minutes==60||a.minutes==-1){if(a.options.direction=="down"){a.minutes=59;a.hours--}else{a.minutes=0;a.hours++}a.options.hours&&a.increaseDigit(a.options.hours)}if(a.hours==
        24||a.hours==-1){if(a.options.direction=="down"){a.hours=23;a.days--}else{a.hours=0;a.days++}a.options.days&&a.increaseDigit(a.options.days)}}},1E3)},increaseDigit:function(a){function h(f){var j=b(f).find(".active"),i=b(f).find(".previous"),e=b.inArray(f,c);i.removeClass("previous");j.removeClass("active").addClass("previous");if(j.next().length==0){d.options.direction=="down"&&a==d.options.hours&&(d.hours==-1||d.hours==23)&&b(f).find(".digit").length==10?b(b(f).find(".digit")[6]).addClass("active"):
        b(f).find(".digit:first-child").addClass("active");e!=0&&h(c[e-1])}else if(d.options.direction=="up"&&a==d.options.hours&&d.hours==24){b(f).find(".digit:first-child").addClass("active");h(c[e-1])}else j.next().addClass("active")}var c=[],d=this;b(a).find(".digit-set").each(function(){c.push(this)});h(c[c.length-1])}};b.fn.Timer=function(a){return this.each(function(){b(this).data("Timer")||b(this).data("Timer",new l(b(this),a))})}})(jQuery);
